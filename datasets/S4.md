# Análisis ROC para la Detección de Floraciones Algales Nocivas (HABs)

Este repositorio contiene un script de R diseñado para simular y analizar datos de ecología marina. El objetivo es demostrar cómo se puede utilizar una curva ROC (Receiver Operating Characteristic) para evaluar la capacidad predictiva de un biomarcador.

## Contexto del Estudio

Este conjunto de datos simula un estudio en ecología marina donde los investigadores están evaluando si la concentración de clorofila-a en el agua (medida en µg/L) puede utilizarse como un indicador predictivo para detectar floraciones algales nocivas (HABs).

Las floraciones algales nocivas son proliferaciones de algas que pueden producir toxinas dañinas para la vida marina, afectar la calidad del agua y tener impactos negativos en la pesca y la acuicultura. La detección temprana de estas floraciones es crucial para implementar medidas de mitigación y proteger los ecosistemas marinos y las actividades económicas relacionadas.

El análisis ROC permitirá determinar qué tan efectivamente los niveles de clorofila-a pueden predecir la presencia de floraciones algales nocivas, estableciendo un umbral óptimo que maximice la sensibilidad y especificidad. Esto podría ser utilizado en sistemas de alerta temprana para la gestión costera y la protección de la acuicultura.

## Descripción del Dataset

El dataset simulado (`df_floracion_500`) contiene 500 observaciones y dos variables:

*   `clorofila_a`: Variable cuantitativa que mide la concentración de clorofila-a en el agua (µg/L), un pigmento fotosintético que sirve como indicador de biomasa fitoplanctónica.
*   `floracion_algal`: Variable categórica binaria (`Ausencia`/`Presencia`) que indica si se ha detectado una floración algal nociva.

## Código en R

El siguiente script genera los datos, realiza una visualización inicial y ejecuta el análisis ROC para evaluar el poder predictivo de la clorofila-a.

```r
# Creación de un dataframe con 500 observaciones para análisis ROC
# Versión ajustada para obtener un AUC aproximado de 0.94

set.seed(456)  # Para reproducibilidad

# Número de observaciones
n <- 500

# Variable cuantitativa: concentración de clorofila-a (µg/L)
# Mantenemos las mismas medias y desviaciones para conservar el AUC ~0.94
clorofila_a_sin_floracion <- rnorm(n/2, mean = 3, sd = 1.8)  # Grupo "Ausencia" (250 obs)
clorofila_a_con_floracion <- rnorm(n/2, mean = 8, sd = 2.5)   # Grupo "Presencia" (250 obs)

# Combinamos los datos en un solo vector
clorofila_a <- c(clorofila_a_sin_floracion, clorofila_a_con_floracion)

# Variable categórica: presencia de floración algal nociva (HAB)
# Creamos el factor correspondiente a los datos generados
floracion_algal <- factor(
  c(rep("Ausencia", n/2), rep("Presencia", n/2)),
  levels = c("Ausencia", "Presencia")
)

# Ensamblamos el dataframe
df_floracion_500 <- data.frame(
  clorofila_a = clorofila_a,
  floracion_algal = floracion_algal
)

# Mostramos un resumen del dataframe
summary(df_floracion_500)

# Visualizamos la distribución con los 500 datos
boxplot(clorofila_a ~ floracion_algal, data = df_floracion_500, 
        xlab = "Floración Algal Nociva", 
        ylab = "Concentración de Clorofila-a (µg/L)",
        main = "Relación con 500 observaciones (AUC ~0.94)",
        col = c("lightblue", "lightcoral"))

# --- Código para realizar el análisis ROC ---
# install.packages("pROC") # Descomentar si no tienes la librería
library(pROC)

# Creamos la curva ROC con el nuevo dataframe
roc_curve <- roc(floracion_algal ~ clorofila_a, data = df_floracion_500)

# Graficamos la curva ROC
plot(roc_curve, main="Curva ROC con 500 datos (AUC ~0.94)", 
     col="blue", lwd=2, print.auc=TRUE)

# Obtenemos las coordenadas del mejor umbral (punto de corte)
best_coords <- coords(roc_curve, x = "best", best.method = "youden", 
                      ret = c("threshold", "sensitivity", "specificity"))

# Añadimos el mejor punto a la gráfica
points(1 - best_coords$specificity, best_coords$sensitivity, pch=19, col="red", cex=1.5)
text(1 - best_coords$specificity, best_coords$sensitivity, 
     labels=paste("Umbral =", round(best_coords$threshold, 2)), pos=4)

# Imprimimos los resultados del mejor umbral
print("Mejores coordenadas (método Youden) con n=500:")
print(best_coords)
```

### Resultados Esperados

Al ejecutar el script, se obtendrá:
1.  Un **boxplot** que muestra una clara diferencia en la distribución de `clorofila_a` entre los grupos de `Ausencia` y `Presencia`, aunque con un ligero solapamiento.
2.  Una **gráfica de la curva ROC** con un Área Bajo la Curva (AUC) de aproximadamente **0.94**, lo que indica una excelente capacidad de discriminación del modelo.
3.  La identificación del **umbral óptimo** de clorofila-a que maximiza tanto la sensibilidad como la especificidad para predecir una floración algal.